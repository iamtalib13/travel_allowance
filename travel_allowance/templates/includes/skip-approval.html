<style>
  /* Navbar styles */

  .ta_skip_navbar {
    display: flex;
    font-size: 15px;
    top: 0;
    align-items: center;
    flex-wrap: wrap;
    padding: 0 5px;
    height: 200px; /* Fixed height (adjust as needed) */
    overflow-y: auto; /* Enables vertical scrolling */
  }

  .ta_skip_navbar div {
    padding: 10px 0px;
    font-size: large;
    cursor: pointer;
  }

  .ta_skip_navbar .active {
    font-weight: bold;
    border-bottom: 2px solid rgba(0, 128, 222, 1);
  }

  .ta-skip-nav-item {
    list-style: none;
    margin: 5px 0;
  }

  .ta-skip-nav-link {
    border: 1px solid transparent;
    border-top-left-radius: 0.25rem;
    border-top-right-radius: 0.25rem;
    padding: 5px 10px;
    margin-right: 5px;
    color: #495057;
    background-color: #f0f6fb;
    transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out,
      border-color 0.15s ease-in-out;
  }
  .ta-skip-nav-link:hover,
  .ta-skip-nav-link:focus {
    text-decoration: none;
    font-weight: bold;
    border-bottom: 2px solid rgba(0, 128, 222, 1);
    outline: none;
  }
  /*.ta-skip-nav-link:before {
    content: "";
    position: absolute;
    bottom: 0;
    left: 0;
    height: 3px;
    width: 0%;
    background: #34efdf;
    border-radius: 12px;
    transition: all 0.4s ease;
  }
  .ta-skip-nav-link:hover:before {
    width: 100%;
  }*/

  .all-pending-count {
    /*color: red;*/
    font-weight: bold;
    margin-left: 5px;
  }
  /* Pending count styles */
  .pending-count {
    color: red;
    font-weight: bold;
    margin-left: 5px;
  }
  .approved-count {
    color: green;
    font-weight: bold;
    margin-left: 5px;
  }

  /* Count span styles */
  .count {
    font-weight: bold;
    margin-left: 5px;
  }

  .main-skip-container {
    border-radius: 8px;
    border: 1px solid #999393;
  }

  table {
    width: 100%; /* Full width */
    border-collapse: collapse; /* Collapse borders */
  }

  /* Make the table responsive */

  /* Table styles */
  table#travelSkipPendingTable {
    width: 100%;
    border-collapse: collapse;
    margin: 20px 0;
    font-size: 14px;
    text-align: left;
  }

  table#travelSkipPendingTable th,
  table#travelSkipPendingTable td {
    padding: 12px 15px;
    border: 1px solid #ddd;
    white-space: nowrap; /* Prevent line wrapping */
    text-align: center;
  }

  /* Header styling */
  table#travelSkipPendingTable thead th {
    background-color: #f2f2f2;
    color: #333;
    font-weight: bold;
    text-align: center;
  }

  /* Hover effects */
  table#travelSkipPendingTable tbody tr:hover {
    background-color: #f1f1f1;
  }

  /* Center align specific columns */
  table#travelSkipPendingTable td:nth-child(4),
  table#travelSkipPendingTable td:nth-child(5),
  table#travelSkipPendingTable td:nth-child(6),
  table#travelSkipPendingTable td:nth-child(7),
  table#travelSkipPendingTable td:nth-child(8),
  table#travelSkipPendingTable td:nth-child(9),
  table#travelSkipPendingTable td:nth-child(10),
  table#travelSkipPendingTable td:nth-child(13),
  table#travelSkipPendingTable td:nth-child(14),
  table#travelSkipPendingTable td:nth-child(15),
  table#travelSkipPendingTable td:nth-child(16),
  table#travelSkipPendingTable td:nth-child(17),
  table#travelSkipPendingTable td:nth-child(18),
  table#travelSkipPendingTable td:nth-child(19) {
    text-align: center;
  }

  /* Checkbox column */
  table#travelSkipPendingTable td:first-child {
    text-align: center;
    width: 50px;
    font-weight: bold;
    color: #000;
    background-color: #e6e7e7;
  }

  /* Highlighting total column */
  table#travelSkipPendingTable td:last-child {
    font-weight: bold;
    color: #000;
    background-color: #e7f3ff;
  }

  /* Table header alignment */
  table#travelSkipPendingTable th {
    text-align: center;
  }

  /* Styling for no records row */
  table#travelSkipPendingTable .text-center {
    text-align: center;
    font-weight: bold;
    color: #999;
  }

  /* Table styles for approved records */
  table#travelSkipApprovedTable {
    width: 100%;
    border-collapse: collapse;
    margin: 20px 0;
    font-size: 14px;
    text-align: left;
  }

  table#travelSkipApprovedTable th,
  table#travelSkipApprovedTable td {
    padding: 12px 15px;
    border: 1px solid #ddd;
    white-space: nowrap; /* Prevent line wrapping */
    text-align: center;
  }

  /* Header styling for approved records */
  table#travelSkipApprovedTable thead th {
    background-color: #d4edda; /* Light green header to indicate approved status */
    color: #155724; /* Dark green text color */
    font-weight: bold;
    text-align: center;
  }

  /* Hover effects for approved records */
  table#travelSkipApprovedTable tbody tr:hover {
    background-color: #f1f1f1;
  }

  /* Center align specific columns for approved records */
  table#travelSkipApprovedTable td:nth-child(4),
  table#travelSkipApprovedTable td:nth-child(5),
  table#travelSkipApprovedTable td:nth-child(6),
  table#travelSkipApprovedTable td:nth-child(7),
  table#travelSkipApprovedTable td:nth-child(8),
  table#travelSkipApprovedTable td:nth-child(9),
  table#travelSkipApprovedTable td:nth-child(10),
  table#travelSkipApprovedTable td:nth-child(13),
  table#travelSkipApprovedTable td:nth-child(14),
  table#travelSkipApprovedTable td:nth-child(15),
  table#travelSkipApprovedTable td:nth-child(16),
  table#travelSkipApprovedTable td:nth-child(17),
  table#travelSkipApprovedTable td:nth-child(18),
  table#travelSkipApprovedTable td:nth-child(19) {
    text-align: center;
  }

  /* Checkbox column for approved records */
  table#travelSkipApprovedTable td:first-child {
    text-align: center;
    width: 50px;
    font-weight: bold;
    color: #000;
    background-color: #e6e7e7;
  }

  /* Highlighting total column for approved records */
  table#travelSkipApprovedTable td:last-child {
    font-weight: bold;
    color: #155724;
    background-color: #c3e6cb; /* Light green background for totals */
  }

  /* Table header alignment */
  table#travelSkipApprovedTable th {
    text-align: center;
  }

  /* Styling for no records row in approved table */
  table#travelSkipApprovedTable .text-center {
    text-align: center;
    font-weight: bold;
    color: #999;
  }

  /* Table styles for rejected records */
  table#travelSkipRejectTable {
    width: 100%;
    border-collapse: collapse;
    margin: 20px 0;
    font-size: 14px;
    text-align: left;
  }

  /* Rejected table headers and cells */
  table#travelSkipRejectTable th,
  table#travelSkipRejectTable td {
    padding: 12px 15px;
    border: 1px solid #ddd;
    white-space: nowrap; /* Prevent line wrapping */
    text-align: center;
  }

  /* Header styling for rejected records */
  table#travelSkipRejectTable thead th {
    background-color: #f8d7da; /* Light red header to indicate rejected status */
    color: #721c24; /* Dark red text color */
    font-weight: bold;
    text-align: center;
  }

  /* Hover effects for rejected records */
  table#travelSkipRejectTable tbody tr:hover {
    background-color: #f1f1f1;
  }

  /* Center align specific columns for rejected records */
  table#travelSkipRejectTable td:nth-child(4),
  table#travelSkipRejectTable td:nth-child(5),
  table#travelSkipRejectTable td:nth-child(6),
  table#travelSkipRejectTable td:nth-child(7),
  table#travelSkipRejectTable td:nth-child(8),
  table#travelSkipRejectTable td:nth-child(9),
  table#travelSkipRejectTable td:nth-child(10),
  table#travelSkipRejectTable td:nth-child(13),
  table#travelSkipRejectTable td:nth-child(14),
  table#travelSkipRejectTable td:nth-child(15),
  table#travelSkipRejectTable td:nth-child(16),
  table#travelSkipRejectTable td:nth-child(17),
  table#travelSkipRejectTable td:nth-child(18),
  table#travelSkipRejectTable td:nth-child(19) {
    text-align: center;
  }

  /* Checkbox column for rejected records */
  table#travelSkipRejectTable td:first-child {
    text-align: center;
    width: 50px;
    font-weight: bold;
    color: #000;
    background-color: #e6e7e7;
  }

  /* Highlighting total column for rejected records */
  table#travelSkipRejectTable td:last-child {
    font-weight: bold;
    color: #721c24;
    background-color: #f5c6cb; /* Light red background for totals */
  }

  /* Table header alignment */
  table#travelSkipRejectTable th {
    text-align: center;
  }

  /* Styling for no records row in rejected table */
  table#travelSkipRejectTable .text-center {
    text-align: center;
    font-weight: bold;
    color: #999;
  }

  .approve-btn {
    display: none;
    position: absolute;
    top: 35px;
    right: 10px;
    z-index: 100;
  }
  .no-skip-records {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100%;
    text-align: center;
    margin: auto;
    font-size: 18px;
    color: #495057;
    margin-bottom: 40px;
  }

  #no-skip-records-message {
    height: 100%;
    text-align: center;
    margin: auto;
    font-size: 18px;
    justify-content: center;
    align-items: center;
    padding: 20px 10px;
    display: none; /* Message is hidden by default */
    font-weight: bold;
    color: #495057;
  }
  .action_menu {
    display: flex;
    text-align: right;
    justify-content: end;
  }
  .btn_bulk_approve {
    margin-right: 10px;
    font-size: 15px;
  }
  .btn_bulk_reject {
    margin-right: 10px;
    font-size: 15px;
  }

  .btn_select_all {
    font-size: 15px;
  }

  button.swal2-confirm.swal2-styled:focus,
  button.swal2-cancel.swal2-styled:focus {
    outline: none;
  }

  /* Fixed Serial Number Column
  .fixed-serial {
    position: sticky;
    left: 0;
    background-color: #302727;
    z-index: 2;
  }


  .fixed-total {
    position: sticky;
    right: 0;

    z-index: 2;
  }*/

  .hidden {
    display: none;
  }
  /* Popup styles */
  .dynamic-popup {
    display: none; /* Hidden by default */
    position: fixed;
    z-index: 9999;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.5); /* Black background with opacity */
  }

  .dynamic-popup-content {
    background-color: #fff;
    margin: 15% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 80%;
    max-width: 800px;
    font-size: 14px;
    font-family: inherit;
  }

  .dynamic-popup-close-btn {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
  }

  .dynamic-popup-close-btn:hover,
  .dynamic-popup-close-btn:focus {
    color: black;
    text-decoration: none;
  }

  .dynamic-table {
    width: 100%;
    border-collapse: collapse;
  }

  .dynamic-table th,
  .dynamic-table td {
    border: 1px solid #ddd;
    padding: 8px;
  }

  .dynamic-table th {
    background-color: #f2f2f2;
  }

  .clickable {
    cursor: pointer; /* Change cursor to pointer */
    position: relative; /* Positioning for the indicator */
    padding: 10px; /* Add some padding */
  }
</style>

<div class="main_skip_content">
  <div class="container-fluid">
    <div class="row">
      <div class="col-12 d-flex px-0">
        <nav class="navbar navbar-expand-lg navbar-light py-2">
          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarNav"
            aria-controls="navbarNav"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ta-skip-nav me-auto">
              <li class="nav-item ta-skip-nav-item">
                <a
                  class="nav-link ta-skip-nav-link active"
                  aria-current="page"
                  id="pendingSkipTab"
                  data-tab-type="pendingSkip"
                >
                  Pending
                  <span class="pending-count" id="pendingSkipCount"></span>
                </a>
              </li>
              <li class="nav-item ta-skip-nav-item">
                <a
                  class="nav-link ta-skip-nav-link"
                  id="approvedSkipTab"
                  data-tab-type="approvedSkip"
                >
                  Approved
                  <span class="approved-count" id="approvedSkipCount"></span>
                </a>
              </li>
              <li class="nav-item ta-skip-nav-item">
                <a
                  class="nav-link ta-skip-nav-link"
                  id="rejectSkipTab"
                  data-tab-type="rejectedSkip"
                >
                  Reject <span class="reject-count" id="rejectSkipCount"></span>
                </a>
              </li>
            </ul>
          </div>
        </nav>

        <div class="action-skip text-end py-3 ms-auto">
          <!-- Collapsible button visible only on small screens -->
          <button
            class="btn btn-primary mb-2 d-lg-none"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#actionsCollapse"
            aria-expanded="false"
            aria-controls="actionsCollapse"
          >
            Actions
          </button>

          <!-- Actions buttons visible on larger screens -->
          <div class="d-none d-lg-block">
            <button class="btn btn-approve me-2" id="approveButtonSkip">
              Approve
            </button>
            <button class="btn btn-reject" id="rejectButtonSkip">Reject</button>
          </div>

          <!-- Collapsible container for small screens -->
          <div class="collapse d-lg-none" id="actionsCollapse">
            <div class="card card-body">
              <button class="btn btn-success me-2" id="approveButtonSkip">
                Approve
              </button>
              <button class="btn btn-danger" id="rejectButtonSkip">
                Reject
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!--Employee Tabs -->
  <div class="container-fluid main-skip-container">
    <div class="row">
      <ul class="nav nav-tabs ta_skip_navbar" id="skipEmpTabs" role="tablist">
        <li class="ta-skip-nav-item">
          <button
            class="ta-skip-nav-link active"
            id="all-skip-tab"
            data-bs-toggle="tab"
            data-employee-name="all"
            onclick="handleSkipTabClick('all', this)"
          >
            All
            <span class="all-pending-count" id="allSkipPendingCount"></span>
          </button>
        </li>
        <!-- Employee tabs will be generated dynamically -->
      </ul>
    </div>

    <!-- Table for travel allowances fetch pending record request-->
    <div class="table-responsive" id="travelSkipPending">
      <table class="table table-bordered" id="travelSkipPendingTable">
        <thead>
          <tr>
            <th class="fixed-serial">#</th>
            <th>
              <input type="checkbox" id="selectAll" />
            </th>

            <th>Employee Name</th>
            <th>Status</th>
            <th>From Location</th>
            <th>Start Date</th>
            <th>Start Time</th>
            <th>To Location</th>
            <th>End Date</th>
            <th>End Time</th>
            <th>Total Time</th>
            <th>Purpose</th>
            <th>Mode of Travel</th>
            <th>Total KM</th>
            <th>Ticket Amount</th>
            <th>Uploaded Ticket</th>
            <th>Fare Amount</th>
            <!-- <th>Allowance Type</th>-->
            <th>DA</th>
            <th>Halting</th>
            <th>Lodging</th>
            <th>Uploaded Lodging Bill</th>
            <th>Local Conveyance</th>
            <th class="fixed-total">Total</th>
            <th class="d-none">Name</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div
        class="no-skip-pending-records text-center py-3"
        style="display: none"
      >
        You have no Pending records.
      </div>
    </div>

    <!-- Table for travel allowances fetch approved record -->
    <div class="table-responsive" id="travelSkipApproved" style="display: none">
      <table class="table table-bordered" id="travelSkipApprovedTable">
        <thead>
          <tr>
            <th class="fixed-serial">#</th>
            <th class="d-none">Name</th>
            <th>Employee Name</th>
            <th>Status</th>
            <th>From Location</th>
            <th>Start Date</th>
            <th>Start Time</th>
            <th>To Location</th>
            <th>End Date</th>
            <th>End Time</th>
            <th>Total Time</th>
            <th>Purpose</th>
            <th>Mode of Travel</th>
            <th>Total KM</th>
            <th>Ticket Amount</th>
            <th>Uploaded Ticket</th>
            <th>Fare Amount</th>
            <!-- <th>Allowance Type</th>-->
            <th>DA</th>
            <th>Halting</th>
            <th>Lodging</th>
            <th>Uploaded Lodging Bill</th>
            <th>Local Conveyance</th>
            <th class="fixed-total">Total</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div
        class="no-skip-approved-records text-center py-3"
        style="display: none"
      >
        You have no Approved records.
      </div>
    </div>

    <!-- Table for travel allowances fetch Rejected record -->
    <div class="table-responsive" id="travelSkipReject" style="display: none">
      <table class="table table-bordered" id="travelSkipRejectTable">
        <thead>
          <tr>
            <th class="fixed-serial">#</th>
            <th class="d-none">Name</th>
            <th>Employee Name</th>
            <th>Status</th>
            <th>From Location</th>
            <th>Start Date</th>
            <th>Start Time</th>
            <th>To Location</th>
            <th>End Date</th>
            <th>End Time</th>
            <th>Total Time</th>
            <th>Purpose</th>
            <th>Mode of Travel</th>
            <th>Total KM</th>
            <th>Ticket Amount</th>
            <th>Uploaded Ticket</th>
            <th>Fare Amount</th>
            <!-- <th>Allowance Type</th>-->
            <th>DA</th>
            <th>Halting</th>
            <th>Lodging</th>
            <th>Uploaded Lodging Bill</th>
            <th>Local Conveyance</th>
            <th class="fixed-total">Total</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div
        class="no-skip-reject-records text-center py-3"
        style="display: none"
      >
        You have no Rejected records.
      </div>
    </div>

    <!-- No records message  for particular employee tab-->
    <div id="no-skip-records-message" style="display: none">
      No records available for this employee.
    </div>
  </div>
  <!-- Add this to your HTML to include a modal or input for remarks -->
  <!--<div id="remarkModal" style="display: none">
      <h3>Enter a Remark</h3>
      <textarea
        id="remarkInput"
        rows="4"
        cols="50"
        placeholder="Enter your remark here..."
      ></textarea>
      <button onclick="submitRejection()">Submit</button>
      <button onclick="closeRemarkModal()">Cancel</button>
    </div>-->
</div>

<!--display message for all three Tab data empty-->
<div class="no-skip-records text-center mt-3" style="display: none">
  <div><img src="/assets/travel_allowance/images/not-found.webp" alt="" /></div>
  You have no Request.
</div>

<script>
  fetchPendingSkipRecords();
  fetchTabCounts();
  async function fetchTabCounts() {
    try {
      const response = await fetch(
        `/api/method/travel_allowance.travel_allowance.doctype.travel_allowances.travel_allowances.get_skip_records?user_id={{ frappe.session.user }}`
      );

      if (!response.ok) {
        throw new Error(`HTTP error! Status: ${response.status}`);
      }

      const data = await response.json();
      const empNames = data.message.employee_names;
      const countByEmp = data.message.employee_counts;
      const pendingRecord = data.message.pending;
      const approvedRecord = data.message.approved;
      const rejectedRecord = data.message.rejected;

      const pendingSkipCount = document.getElementById("pendingSkipCount");
      const approvedSkipCount = document.getElementById("approvedSkipCount");
      const rejectSkipCount = document.getElementById("rejectSkipCount");

      pendingSkipCount.textContent = pendingRecord.length || "";
      approvedSkipCount.textContent = approvedRecord.length || "";
      rejectSkipCount.textContent = rejectedRecord.length || "";
    } catch (error) {
      console.error("Error fetching employee names:", error);
    }
  }

  document.addEventListener("DOMContentLoaded", function () {
    const pendingSkipTab = document.getElementById("pendingSkipTab");
    const approvedSkipTab = document.getElementById("approvedSkipTab");
    const rejectSkipTab = document.getElementById("rejectSkipTab");

    const pendingSkipTable = document.getElementById("travelSkipPendingTable");
    const approvedSkipTable = document.getElementById("travelSkipApproved");
    const rejectSkipTable = document.getElementById("travelSkipReject");

    //get action buttons
    const actionSkipMenu = document.querySelector(".action-skip");

    const noSkipPendingRecordsMsg = document.querySelector(
      ".no-skip-pending-records"
    );
    const noSkipApprovedRecordsMsg = document.querySelector(
      ".no-skip-approved-records"
    );
    const noSkipRejectRecordsMsg = document.querySelector(
      ".no-skip-reject-records"
    );

    // Initially show the pending table
    pendingSkipTable.style.display = "block";
    approvedSkipTable.style.display = "none";
    rejectSkipTable.style.display = "none";

    // Add event listeners for tab clicks
    pendingSkipTab.addEventListener("click", function () {
      toggleActiveTab(pendingSkipTab);
      showTable("pending"); // Show pending records table
      fetchPendingSkipRecords(); // Fetch pending records
      noSkipApprovedRecordsMsg.style.display = "none";
      noSkipRejectRecordsMsg.style.display = "none";
      actionSkipMenu.style.display = "block";
    });

    approvedSkipTab.addEventListener("click", function () {
      toggleActiveTab(approvedSkipTab);
      showTable("approved"); // Show approved records table
      fetchApprovedSkipRecords(); // Fetch approved records
      noSkipPendingRecordsMsg.style.display = "none";
      noSkipRejectRecordsMsg.style.display = "none";
      actionSkipMenu.style.display = "none";
    });

    rejectSkipTab.addEventListener("click", function () {
      toggleActiveTab(rejectSkipTab);
      showTable("rejected"); // Show rejected records table
      fetchRejectedSkipRecords(); // Fetch rejected records
      noSkipApprovedRecordsMsg.style.display = "none";
      noSkipPendingRecordsMsg.style.display = "none";
      actionSkipMenu.style.display = "none";
    });

    // Function to toggle the active class
    function toggleActiveTab(activeTab) {
      pendingSkipTab.classList.remove("active");
      approvedSkipTab.classList.remove("active");
      rejectSkipTab.classList.remove("active");

      activeTab.classList.add("active");
    }

    // Function to manage table visibility
    function showTable(type) {
      if (type === "pending") {
        pendingSkipTable.style.display = "block";
        approvedSkipTable.style.display = "none";
        rejectSkipTable.style.display = "none";
      } else if (type === "approved") {
        pendingSkipTable.style.display = "none";
        approvedSkipTable.style.display = "block";
        rejectSkipTable.style.display = "none";
      } else if (type === "rejected") {
        pendingSkipTable.style.display = "none";
        approvedSkipTable.style.display = "none";
        rejectSkipTable.style.display = "block";
      }
    }
  });

  // Handle employee tab click
  function handleSkipTabClick(skipEmpName, element) {
    console.log(`Tab clicked: ${skipEmpName}`);

    // Remove "active" class from all nav-links
    const buttons = document.querySelectorAll("#skipEmpTabs .ta-skip-nav-link");
    buttons.forEach((button) => {
      button.classList.remove("active");
    });

    // Add "active" class to the clicked tab
    element.classList.add("active");

    // Find the currently active main tab (Pending, Approved, Rejected)
    const activeMainTab = document.querySelector(
      ".ta-skip-nav .ta-skip-nav-link.active"
    );
    console.log("active tab", activeMainTab);
    const mainTabType = activeMainTab
      ? activeMainTab.getAttribute("data-tab-type")
      : null;

    console.log("Active Main Tab Type:", mainTabType);
    if (!mainTabType) {
      console.error("No main tab found.");
      return;
    }

    // Pass the employee name and main tab type to filter function
    filterSkipTableByEmployee(skipEmpName, mainTabType);
  }

  // Filter table based on employee name and main tab (Pending, Approved, Rejected)
  function filterSkipTableByEmployee(employeeName, tabType) {
    let tableBody;
    let noRecordsMessage;
    let tableSkip;

    const noRecordsByEmpMsg = document.getElementById(
      "no-skip-records-message"
    );
    // Determine the table and message elements based on the active tab
    if (tabType === "pendingSkip") {
      tableBody = document.querySelector("#travelSkipPendingTable tbody");
      noRecordsMessage = document.querySelector(".no-skip-pending-records");
      tableSkip = document.getElementById("travelSkipPending");
    } else if (tabType === "approvedSkip") {
      tableBody = document.querySelector("#travelSkipApprovedTable tbody");
      noRecordsMessage = document.querySelector(".no-skip-approved-records");
      tableSkip = document.getElementById("travelSkipApproved");
    } else if (tabType === "rejectedSkip") {
      tableBody = document.querySelector("#travelSkipRejectTable tbody");
      noRecordsMessage = document.querySelector(".no-skip-reject-records");
      tableSkip = document.getElementById("travelSkipReject");
    }
    console.log("table", tableBody);
    console.log("tabtype", tabType);

    if (!tableBody) {
      console.error(
        "Error: Table body element not found for " + tabType + " tab."
      );
      return;
    }

    const rows = tableBody.querySelectorAll("tr");
    let visibleRows = 0; // Counter for visible rows
    let serialNumber = 1;

    // Loop through all rows and hide those that don't match the employee name
    rows.forEach((row) => {
      const fullName = row.querySelector("td:nth-child(3)").innerText.trim(); // Adjust the column index if necessary

      // Show rows if they match the employee name or if 'All' is selected
      if (
        employeeName.toLowerCase() === "all" ||
        fullName.toLowerCase() === employeeName.toLowerCase()
      ) {
        row.style.display = ""; // Show the row
        const serialCell = row.querySelector("td:nth-child(1)"); // Assuming the serial number is in the first column
        serialCell.textContent = serialNumber++;
        visibleRows++;
      } else {
        row.style.display = "none"; // Hide the row
      }
    });

    // Handle no records message visibility
    if (visibleRows === 0) {
      noRecordsByEmpMsg.style.display = "block"; // Show "no records" message
      tableSkip.style.display = "none"; // Hide table if no records found
    } else {
      noRecordsByEmpMsg.style.display = "none"; // Hide "no records" message
      tableSkip.style.display = "block"; // Show table if records are found
    }
    if (employeeName.toLowerCase() === "all") {
      noRecordsByEmpMsg.style.display = "none"; // Hide "no records" message
    }
  }

  // fetch the count according to emp names
  function renderSkipEmployeeTabs(empNames, countByEmp, tabType) {
    const skipEmpTabs = document.getElementById("skipEmpTabs");
    skipEmpTabs.innerHTML = ""; // Clear previous tabs

    // Initialize total count for "All" tab
    let totalCount = 0;

    // Check if "All" tab already exists
    const allTabExists = document.getElementById("all-skip-tab");

    if (!allTabExists) {
      // Create the "All" tab
      const allTabItem = document.createElement("li");
      allTabItem.className = "ta-skip-nav-item";
      allTabItem.innerHTML = `
            <button
                class="ta-skip-nav-link active"
                id="all-skip-tab"
                data-bs-toggle="tab"
                data-employee-name="all"
                onclick="handleSkipTabClick('all', this)"
            >
                All
                <span class="all-pending-count" id="allSkipPendingCount"></span>
            </button>
        `;
      skipEmpTabs.appendChild(allTabItem);
    }

    empNames.forEach((employee) => {
      const employeeId = employee.employee_id; // Assuming employee_id is available
      const employeeFullName = employee.full_name; // Assuming full_name is available
      const count = countByEmp[tabType][employeeId]; // Get the count for this employee

      totalCount += count; // Add to total count

      const tabItem = document.createElement("li");
      tabItem.className = "ta-skip-nav-item";
      tabItem.innerHTML = `<button
                class="ta-skip-nav-link"
                id="emp-skip-tab-${employeeId}"
                data-bs-toggle="tab"
                data-employee-name="${employeeFullName}"
                onclick="handleSkipTabClick('${employeeFullName}', this)"
              >
                ${capitalizeFirstLetterOfEachWord(employeeFullName)}
                <span class="emp-pending-count">${count || ""} </span>
              </button>`;
      skipEmpTabs.appendChild(tabItem);
    });

    // Update "All" tab count
    const allCountElement = document.getElementById("allSkipPendingCount");
    if (totalCount != 0) {
      allCountElement.innerText = totalCount; // Set total count for "All" tab
    } else {
      allCountElement.innerText = ""; // Set total count for "All" tab
    }
  }

  async function fetchPendingSkipRecords() {
    const noRecordsByEmpMsg = document.getElementById(
      "no-skip-records-message"
    );
    noRecordsByEmpMsg.style.display = "none";
    try {
      // Fetch pending records
      const response = await fetch(
        `/api/method/travel_allowance.travel_allowance.doctype.travel_allowances.travel_allowances.get_skip_records?user_id={{ frappe.session.user }}`
      );

      // Check if the response is ok (status code 200-299)
      if (!response.ok) {
        throw new Error(`HTTP error! Status: ${response.status}`);
      }

      // Parse the JSON data from the response
      const data = await response.json();

      console.log("data from skip:", data);

      const pendingRecord = data.message.pending;
      const approvedRecord = data.message.approved;
      const rejectedRecord = data.message.rejected;
      const empNames = data.message.employee_names;
      const countByEmp = data.message.employee_counts;
      const empPendingCount = countByEmp.pending;
      console.log("skip data:", pendingRecord);
      console.log("countByEmp:", countByEmp.pending);

      // Render employee tabs
      renderSkipEmployeeTabs(empNames, countByEmp, "pending");

      const tableBody = document.querySelector("#travelSkipPendingTable tbody");
      const noRecordsMessage = document.querySelector(".no-skip-records");
      const noPendingRecord = document.querySelector(
        ".no-skip-pending-records"
      );

      const pendingSkipTableHead = document.querySelector(
        "#travelSkipPendingTable"
      );

      if (!tableBody) {
        console.error("Error: Table body element not found.");
        return;
      }

      // Clear existing rows
      tableBody.innerHTML = "";

      if (pendingRecord.length === 0) {
        console.log("pendingRecord length:", pendingRecord.length);
        pendingSkipTableHead.style.display = "none";
        noPendingRecord.style.display = "block";
        // document.querySelector(".main_skip_content").style.display = "none";

        if (approvedRecord.length != 0 || rejectedRecord.length != 0) {
          noRecordsMessage.style.display = "none";
          document.querySelector(".main_skip_content").style.display = "block";
        } else {
          noRecordsMessage.style.display = "block";
          document.querySelector(".main_skip_content").style.display = "none";
        }
      } else {
        noPendingRecord.style.display = "none";
        pendingRecord.forEach((record, index) => {
          const row = document.createElement("tr");

          row.innerHTML = `
                  <td class="fixed-serial">${index + 1}</td>
                  <td><input type="checkbox" class="skipRowCheckbox" onclick="handleSkipCheckboxClick(this, '${
                    record.name
                  }')" /></td>

                  
                  <td>${record.first_name} ${record.last_name}</td>
                  <td>${record.status}</td>
                  <td>
                    ${
                      record.from_location === "Other"
                        ? record.from_location_other
                        : record.from_location
                    }
                  </td>

                  <td>${formatDate(record.from_date)}</td>
                  <td>${record.from_time}</td>
                  <td>
                    ${
                      record.to_location === "Other"
                        ? record.to_location_other
                        : record.to_location
                    }
                  </td>
                  <td>${formatDate(record.to_date)}</td>
                  <td>${record.to_time}</td>
                  <td>${record.total_time}</td>
                  <td>${record.purpose}</td>
                  <td>${record.travel_mode}</td>
                  <td>${record.total_km}</td>
                  <td>${record.ticket_amount}</td>
                  <td>${
                    record.upload_ticket
                      ? `<a href="${record.upload_ticket}" target="_blank">View</a>`
                      : "-"
                  }</td>
                  <td>${record.fare_amount}</td>
                 <!-- <td>${record.allowance_type}</td>-->
                  <td>${record.final_da_amount}</td>
                  <td>${record.final_halt_amount}</td>
                  <td>${record.final_lodge_amount}</td>
                  <td>${
                    record.upload_lodging
                      ? `<a href="${record.upload_lodging}" target="_blank">View</a>`
                      : "-"
                  }</td>
                  <td class="${
                    record.final_local_amount &&
                    record.final_local_amount.trim() !== "-" &&
                    parseFloat(record.final_local_amount) !== 0
                      ? "clickable"
                      : ""
                  }"
                    data-record-id="${record.name}"
                    ${
                      record.final_local_amount &&
                      record.final_local_amount.trim() !== "-" &&
                      parseFloat(record.final_local_amount) !== 0
                        ? `title="Click for Local details"`
                        : ""
                    }>
                    ${record.final_local_amount || "-"}
                  </td>
                  <td class="fixed-total">${record.total_amount}</td>
                  <td class="d-none" data-record-name="${record.name}">${
            record.name
          }</td>
                `;

          // Add event listener to the final_local_amount cell if it has a clickable class
          const localConveyanceCell = row.querySelector(".clickable");
          if (localConveyanceCell) {
            localConveyanceCell.addEventListener("click", () => {
              const recordId =
                localConveyanceCell.getAttribute("data-record-id");
              console.log(recordId);
              fetchLocalConveyance(recordId); // Fetch the local conveyance records
            });
          }

          tableBody.appendChild(row);
        });
      }
    } catch (error) {
      console.error("Error:", error);
    }
  }

  function formatDate(dateString) {
    if (!dateString) return ""; // Return empty string if no date is provided
    const [year, month, day] = dateString.split("-");
    return `${day}-${month}-${year}`;
  }
  function capitalizeFirstLetterOfEachWord(str) {
    return str
      .split(" ") // Split the string into an array of words
      .map((word) => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()) // Capitalize the first letter
      .join(" "); // Join the array back into a string
  }
  // Function to handle checkbox click
  window.handleSkipCheckboxClick = function (checkbox, recordName) {
    if (checkbox.checked) {
      console.log("Selected Skip Record Name: ", recordName);
      checkbox.dataset.recordId = recordName; // Store record ID in checkbox dataset
    }
  };

  function getSelectedSkipRows() {
    const selectedRecords = [];
    const checkboxes = document.querySelectorAll(".skipRowCheckbox:checked"); // Find all checked checkboxes

    checkboxes.forEach((checkbox) => {
      const recordName = checkbox
        .closest("tr")
        .querySelector("td[data-record-name]")
        .getAttribute("data-record-name");
      selectedRecords.push(recordName);
    });

    return selectedRecords;
  }

  // Function to handle the approval process for skip-level records
  async function approveSelectedSkipRecords() {
    const selectedRows = getSelectedSkipRows();
    console.log("selected rows:", selectedRows);

    if (selectedRows.length === 0) {
      Swal.fire({
        icon: "warning",
        title: "No records selected",
        text: "Please select at least one record to approve.",
      });
      return;
    }

    // Ask for confirmation before proceeding with approval
    const { value: confirm } = await Swal.fire({
      title: "Are you sure?",
      text: `You are about to approve ${selectedRows.length} record(s).`,
      icon: "warning",
      showCancelButton: true,
      confirmButtonText: "Yes, approve!",
      cancelButtonText: "Cancel",
    });

    if (confirm) {
      // Ask for a remark or comment
      const { value: remark } = await Swal.fire({
        title: "Add Remark",
        input: "textarea",
        inputPlaceholder: "Enter your remark or comment here...",
        showCancelButton: true,
        confirmButtonText: "Submit Remark",
        cancelButtonText: "Cancel",
      });

      if (remark) {
        try {
          // Show the "Please wait" message during the approval process
          Swal.fire({
            title: "Please wait...",
            text: "Approving records...",
            allowOutsideClick: false,
            didOpen: () => {
              Swal.showLoading();
            },
          });

          // Pass the selected rows and remark to your server in the fetch call
          const response = await fetch(
            "/api/method/travel_allowance.travel_allowance.doctype.travel_allowances.travel_allowances.bulk_skip_approve",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ ids: selectedRows, remark: remark }),
            }
          );

          if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
          }

          const result = await response.json();

          // Close the previous "Please wait" message
          Swal.close();

          // Show the success message and then a "Please wait" message while refreshing
          Swal.fire({
            title: "Approved!",
            text: "Records have been processed for approval.",
            icon: "success",
            confirmButtonText: "OK",
          }).then(() => {
            Swal.fire({
              title: "Please wait",
              text: "Refreshing the page...",
              allowOutsideClick: false,
              allowEscapeKey: false,
              didOpen: () => {
                Swal.showLoading();
              },
            });

            // Add a delay before refreshing the table
            setTimeout(() => {
              // Refresh the entire page
              window.location.reload();
              // Optionally, refresh other data if needed
              //fetchPendingSkipRecords();
              //fetchTabCounts();

              // Close the loading message after the refresh
              Swal.close();
            }, 1500); // Adjust the delay time as needed
          });
        } catch (error) {
          console.error("Error:", error);
          Swal.fire({
            icon: "error",
            title: "Error",
            text: "An error occurred while approving records.",
          });
        }
      }
    }
  }

  // Event listener for the approve button
  document
    .getElementById("approveButtonSkip")
    .addEventListener("click", approveSelectedSkipRecords);

  // Function to handle the rejection process
  async function rejectSelectedSkipRecords() {
    const selectedRows = getSelectedSkipRows();
    console.log("selected rows:", selectedRows);

    if (selectedRows.length === 0) {
      Swal.fire({
        icon: "warning",
        title: "No records selected",
        text: "Please select at least one record to reject.",
      });
      return;
    }

    // Ask for a remark before confirming rejection
    const { value: remark } = await Swal.fire({
      title: "Enter Reason",
      input: "textarea",
      inputLabel: "",
      inputPlaceholder: "Enter Reason of Reject...",
      inputAttributes: {
        "aria-label": "Type your Reason here",
      },
      showCancelButton: true,
      confirmButtonText: "Reject",
      cancelButtonText: "Cancel",
      preConfirm: (inputValue) => {
        if (!inputValue) {
          Swal.showValidationMessage("Please enter a remark");
        }
        return inputValue;
      },
    });

    // Proceed with rejection if remark is provided
    if (remark) {
      // Ask for confirmation before proceeding with rejection
      const { value: confirm } = await Swal.fire({
        title: "Are you sure?",
        text: `You are about to reject ${selectedRows.length} record(s).`,
        icon: "warning",
        showCancelButton: true,
        confirmButtonText: "Yes, reject!",
        cancelButtonText: "Cancel",
      });

      if (confirm) {
        try {
          // Pass these record names and remark to your server in the fetch call
          const response = await fetch(
            "/api/method/travel_allowance.travel_allowance.doctype.travel_allowances.travel_allowances.bulk_skip_reject",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ ids: selectedRows, remark: remark }), // Include remark
            }
          );

          if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
          }

          const result = await response.json();

          Swal.fire({
            title: "Rejected!",
            text: "Selected records have been rejected.",
            icon: "success",
            confirmButtonText: "OK",
          }).then(() => {
            Swal.fire({
              title: "Please wait",
              text: "Refreshing the page...",
              allowOutsideClick: false,
              allowEscapeKey: false,
              didOpen: () => {
                Swal.showLoading();
              },
            });
            // Add a delay before refreshing the table
            setTimeout(() => {
              // Refresh the entire page
              window.location.reload();
              fetchPendingRecords(); // Refresh the table
              fetchTabCounts();
              Swal.close(); // Close the loading message
            }, 1500); // Adjust the delay time as needed
          });
        } catch (error) {
          console.error("Error:", error);
          Swal.fire({
            icon: "error",
            title: "Error",
            text: "An error occurred while rejecting records.",
          });
        }
      }
    }
  }

  // Event listener for the reject button
  document
    .getElementById("rejectButtonSkip")
    .addEventListener("click", rejectSelectedSkipRecords);

  //Fetch Approved Records
  async function fetchApprovedSkipRecords() {
    try {
      // Make a fetch request to get approved skip records
      const response = await fetch(
        `/api/method/travel_allowance.travel_allowance.doctype.travel_allowances.travel_allowances.get_skip_records?user_id={{ frappe.session.user }}`
      );

      // Check if the response status is okay
      if (!response.ok) {
        throw new Error(`HTTP error! Status: ${response.status}`);
      }

      // Parse the JSON data from the response
      const data = await response.json();
      console.log("Approved skip records:", data.message.approved);

      // Process the approved records (assuming the data structure contains an 'approved' field)
      const approvedRecords = data.message.approved;
      const empNames = data.message.employee_names;
      const countByEmp = data.message.employee_counts;

      // Render employee tabs with names and count
      renderSkipEmployeeTabs(empNames, countByEmp, "approved");

      // Check if "All" emp tab exists
      const allTabExists = document.getElementById("all-skip-tab");

      const noRecordsByEmpMsg = document.getElementById(
        "no-skip-records-message"
      );
      noRecordsByEmpMsg.style.display = "none";

      const tableSkipPending = document.getElementById(
        "travelSkipPendingTable"
      );
      if (tableSkipPending) {
        tableSkipPending.style.display = "none"; // hide pending records table
      }

      const tableSkipBody = document.querySelector(
        "#travelSkipApprovedTable tbody"
      );

      const noSkipApprovedRecords = document.querySelector(
        ".no-skip-approved-records"
      );
      const approvedSkipTableHead = document.querySelector(
        "#travelSkipApprovedTable"
      );

      if (!tableSkipBody) {
        console.error("Error: Table body element not found.");
        return;
      }
      tableSkipBody.innerHTML = "";

      // Perform necessary actions, e.g., updating the UI with approved records
      if (approvedRecords.length > 0) {
        console.log("Number of approved records:", approvedRecords.length);

        // Populate table rows with the approved records
        approvedRecords.forEach((record, index) => {
          const row = document.createElement("tr");

          row.innerHTML = `
                <td class="fixed-serial">${index + 1}</td>
                <td class="d-none" data-record-name="${record.name}">${
            record.name
          }</td>
                <td>${record.first_name} ${record.last_name}</td>
                <td>${record.status}</td>
                <td>
                  ${
                    record.from_location === "Other"
                      ? record.from_location_other
                      : record.from_location
                  }
                </td>

                <td>${formatDate(record.from_date)}</td>
                <td>${record.from_time}</td>
                <td>
                  ${
                    record.to_location === "Other"
                      ? record.to_location_other
                      : record.to_location
                  }
                </td>
                <td>${formatDate(record.to_date)}</td>
                <td>${record.to_time}</td>
                <td>${record.total_time}</td>
                <td>${record.purpose}</td>
                <td>${record.travel_mode}</td>
                <td>${record.total_km}</td>
                <td>${record.ticket_amount}</td>
                <td>${
                  record.upload_ticket
                    ? `<a href="${record.upload_ticket}" target="_blank">View</a>`
                    : "-"
                }</td>
                <td>${record.fare_amount}</td>
                <!-- <td>${record.allowance_type}</td>-->
                <td>${record.final_da_amount}</td>
                <td>${record.final_halt_amount}</td>
                <td>${record.final_lodge_amount}</td>
                <td>${
                  record.upload_lodging
                    ? `<a href="${record.upload_lodging}" target="_blank">View</a>`
                    : "-"
                }</td>
                <td class="${
                  record.final_local_amount &&
                  record.final_local_amount.trim() !== "-" &&
                  parseFloat(record.final_local_amount) !== 0
                    ? "clickable"
                    : ""
                }"
                  data-record-id="${record.name}"
                  ${
                    record.final_local_amount &&
                    record.final_local_amount.trim() !== "-" &&
                    parseFloat(record.final_local_amount) !== 0
                      ? `title="Click for Local details"`
                      : ""
                  }>
                  ${record.final_local_amount || "-"}
                </td>
                <td class="fixed-total">${record.total_amount}</td>
              `;
          // Add event listener to the final_local_amount cell if it has a clickable class
          const localConveyanceCell = row.querySelector(".clickable");
          if (localConveyanceCell) {
            localConveyanceCell.addEventListener("click", () => {
              const recordId =
                localConveyanceCell.getAttribute("data-record-id");
              console.log(recordId);
              fetchLocalConveyance(recordId); // Fetch the local conveyance records
            });
          }

          // Append the row to the approved table body
          tableSkipBody.appendChild(row);
        });
      } else {
        approvedSkipTableHead.style.display = "none";
        noSkipApprovedRecords.style.display = "block"; // show the no record message
        if (allTabExists.classList.contains("active")) {
          noRecordsByEmpMsg.style.display = "none";
        }
      }
    } catch (error) {
      console.error("Error fetching approved skip records:", error);
      Swal.fire({
        icon: "error",
        title: "Error",
        text: "An error occurred while fetching approved records. Please try again later.",
      });
    }
  }

  //Fetch Reject Records
  async function fetchRejectedSkipRecords() {
    try {
      // Make a fetch request to get approved skip records
      const response = await fetch(
        `/api/method/travel_allowance.travel_allowance.doctype.travel_allowances.travel_allowances.get_skip_records?user_id={{ frappe.session.user }}`
      );

      // Check if the response status is okay
      if (!response.ok) {
        throw new Error(`HTTP error! Status: ${response.status}`);
      }

      // Parse the JSON data from the response
      const data = await response.json();
      console.log("Approved skip records:", data.message.rejected);

      // Process the approved records (assuming the data structure contains an 'approved' field)
      const rejetedRecords = data.message.rejected;
      const empNames = data.message.employee_names;
      const countByEmp = data.message.employee_counts;

      // Render employee tabs to fetch count by emp
      renderSkipEmployeeTabs(empNames, countByEmp, "rejected");

      // Check if "All" emp tab exists
      const allTabExists = document.getElementById("all-skip-tab");

      const noRecordsByEmpMsg = document.getElementById(
        "no-skip-records-message"
      );

      const tableSkipBody = document.querySelector(
        "#travelSkipRejectTable tbody"
      );

      const noSkipRejectRecords = document.querySelector(
        ".no-skip-reject-records"
      );
      const rejectSkipTableHead = document.querySelector(
        "#travelSkipRejectTable"
      );

      if (!tableSkipBody) {
        console.error("Error: Table body element not found.");
        return;
      }
      tableSkipBody.innerHTML = "";

      // Perform necessary actions, e.g., updating the UI with approved records
      if (rejetedRecords.length > 0) {
        console.log("Number of approved records:", rejetedRecords.length);

        // Populate table rows with the approved records
        rejetedRecords.forEach((record, index) => {
          const row = document.createElement("tr");

          row.innerHTML = `
                <td class="fixed-serial">${index + 1}</td>
                <td class="d-none" data-record-name="${record.name}">${
            record.name
          }</td>
                <td>${record.first_name} ${record.last_name}</td>
                <td>${record.status}</td>
                <td>
                  ${
                    record.from_location === "Other"
                      ? record.from_location_other
                      : record.from_location
                  }
                </td>

                <td>${formatDate(record.from_date)}</td>
                <td>${record.from_time}</td>
                <td>
                  ${
                    record.to_location === "Other"
                      ? record.to_location_other
                      : record.to_location
                  }
                </td>
                <td>${formatDate(record.to_date)}</td>
                <td>${record.to_time}</td>
                <td>${record.total_time}</td>
                <td>${record.purpose}</td>
                <td>${record.travel_mode}</td>
                <td>${record.total_km}</td>
                <td>${record.ticket_amount}</td>
                <td>${
                  record.upload_ticket
                    ? `<a href="${record.upload_ticket}" target="_blank">View</a>`
                    : "-"
                }</td>
                <td>${record.fare_amount}</td>
                <!-- <td>${record.allowance_type}</td>-->
                <td>${record.final_da_amount}</td>
                <td>${record.final_halt_amount}</td>
                <td>${record.final_lodge_amount}</td>
                <td>${
                  record.upload_lodging
                    ? `<a href="${record.upload_lodging}" target="_blank">View</a>`
                    : "-"
                }</td>
                <td class="${
                  record.final_local_amount &&
                  record.final_local_amount.trim() !== "-" &&
                  parseFloat(record.final_local_amount) !== 0
                    ? "clickable"
                    : ""
                }"
                  data-record-id="${record.name}"
                  ${
                    record.final_local_amount &&
                    record.final_local_amount.trim() !== "-" &&
                    parseFloat(record.final_local_amount) !== 0
                      ? `title="Click for Local details"`
                      : ""
                  }>
                  ${record.final_local_amount || "-"}
                </td>
                <td class="fixed-total">${record.total_amount}</td>
              `;
          // Add event listener to the final_local_amount cell if it has a clickable class
          const localConveyanceCell = row.querySelector(".clickable");
          if (localConveyanceCell) {
            localConveyanceCell.addEventListener("click", () => {
              const recordId =
                localConveyanceCell.getAttribute("data-record-id");
              console.log(recordId);
              fetchLocalConveyance(recordId); // Fetch the local conveyance records
            });
          }

          // Append the row to the approved table body
          tableSkipBody.appendChild(row);
        });
      } else {
        rejectSkipTableHead.style.display = "none";
        noSkipRejectRecords.style.display = "block"; // show the no record message
        if (allTabExists.classList.contains("active")) {
          noRecordsByEmpMsg.style.display = "none";
        }
      }
    } catch (error) {
      console.error("Error fetching approved skip records:", error);
      Swal.fire({
        icon: "error",
        title: "Error",
        text: "An error occurred while fetching approved records. Please try again later.",
      });
    }
  }
</script>
